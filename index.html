<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Adelantos Empresarial</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/umd/lucide.js"></script>
    <style>
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        .day-cell {
            min-height: 80px;
            padding: 4px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            background: white;
        }
        .day-cell:hover {
            background: #f9fafb;
        }
        .day-cell.not-current-month {
            background: #f3f4f6;
            color: #9ca3af;
        }
        .day-cell.today {
            border-color: #3b82f6;
            background: #eff6ff;
        }
        .adelanto-indicator {
            font-size: 10px;
            background: #dbeafe;
            color: #1e40af;
            border-radius: 4px;
            padding: 1px 4px;
            margin: 1px 0;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            padding: 24px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <div class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">Sistema de Adelantos</h1>
                    <p class="text-sm text-gray-600">Mes actual: <span id="mesActualDisplay">2025-01</span> <span id="estadoMesActual">(Activo)</span></p>
                </div>
                <div class="flex space-x-2">
                    <button onclick="cambiarVista('dashboard')" id="btn-dashboard" class="px-4 py-2 rounded-lg bg-blue-600 text-white">
                        üìÖ Dashboard
                    </button>
                    <button onclick="cambiarVista('busqueda')" id="btn-busqueda" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700">
                        üîç B√∫squeda
                    </button>
                    <button onclick="cambiarVista('empleados')" id="btn-empleados" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700">
                        üë• Empleados
                    </button>
                    <button onclick="cambiarVista('adelantos')" id="btn-adelantos" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700">
                        üí∞ Adelantos
                    </button>
                    <button onclick="cambiarVista('historial')" id="btn-historial" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700">
                        üìö Historial
                    </button>
                    <button onclick="cambiarVista('config')" id="btn-config" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700">
                        üêô GitHub
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Dashboard -->
        <div id="vista-dashboard" class="vista-contenido">
            <div class="space-y-6">
                <!-- Control de mes y acciones principales -->
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold">Panel de Control Mensual</h2>
                        <div class="flex space-x-3">
                            <select id="selector-mes" onchange="cambiarMesSeleccionado()" class="border rounded-lg px-3 py-2">
                                <!-- Se llena din√°micamente -->
                            </select>
                            
                            <button onclick="toggleVistaCalendario()" id="btn-calendario" class="px-4 py-2 rounded-lg flex items-center bg-gray-200 text-gray-700">
                                üìÖ <span id="texto-vista-calendario">Calendario</span>
                            </button>
                            
                            <button onclick="cerrarMesActual()" id="btn-cerrar-mes" class="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 flex items-center" style="display: none;">
                                üîí Cerrar Mes
                            </button>
                            
                            <button onclick="reabrirMes()" id="btn-reabrir-mes" class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 flex items-center" style="display: none;">
                                üîì Reabrir
                            </button>
                            
                            <button onclick="exportarDatos()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center">
                                üì• Exportar
                            </button>
                            <button onclick="sincronizarGithub()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 flex items-center">
                                üíæ Sincronizar
                            </button>
                        </div>
                    </div>

                    <!-- Estado del mes seleccionado -->
                    <div id="alerta-mes-cerrado" class="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-4" style="display: none;">
                        <div class="flex items-center">
                            <span class="text-orange-600 mr-3">üîí</span>
                            <div>
                                <h3 class="text-sm font-medium text-orange-800">Mes cerrado</h3>
                                <p class="text-sm text-orange-700 mt-1" id="fecha-cierre-mes">Este mes est√° cerrado</p>
                            </div>
                        </div>
                    </div>

                    <!-- Estad√≠sticas del mes seleccionado -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <div class="flex items-center">
                                <div class="text-blue-600 mr-4">üí∞</div>
                                <div>
                                    <p class="text-sm font-medium text-blue-600">Total del Mes</p>
                                    <p class="text-2xl font-bold text-blue-900" id="total-mes">$0</p>
                                    <p class="text-xs text-blue-700" id="mes-estadistica">2025-01</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <div class="flex items-center">
                                <div class="text-green-600 mr-4">üìÖ</div>
                                <div>
                                    <p class="text-sm font-medium text-green-600">Adelantos</p>
                                    <p class="text-2xl font-bold text-green-900" id="cantidad-adelantos">0</p>
                                    <p class="text-xs text-green-700">Transacciones</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <div class="flex items-center">
                                <div class="text-purple-600 mr-4">üë•</div>
                                <div>
                                    <p class="text-sm font-medium text-purple-600">Empleados</p>
                                    <p class="text-2xl font-bold text-purple-900" id="cantidad-empleados">0</p>
                                    <p class="text-xs text-purple-700">Registrados</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <div class="flex items-center">
                                <div class="text-orange-600 mr-4">üìö</div>
                                <div>
                                    <p class="text-sm font-medium text-orange-600">Per√≠odos</p>
                                    <p class="text-2xl font-bold text-orange-900" id="periodos-cerrados">0</p>
                                    <p class="text-xs text-orange-700">Cerrados</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Vista de Calendario o Lista -->
                <div id="vista-lista" class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b">
                        <h3 class="text-lg font-medium">Adelantos de <span id="titulo-mes-lista">2025-01</span></h3>
                        <p class="text-sm text-orange-600 mt-1" id="aviso-mes-cerrado-lista" style="display: none;">‚ö†Ô∏è Este mes est√° cerrado - Solo lectura</p>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Empleado</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Monto</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivo</th>
                                </tr>
                            </thead>
                            <tbody id="tabla-adelantos-mes" class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td colspan="5" class="px-6 py-4 text-center text-gray-500">
                                        No hay adelantos registrados en este mes
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Vista de Calendario -->
                <div id="vista-calendario" class="bg-white rounded-lg shadow" style="display: none;">
                    <div class="px-6 py-4 border-b">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-medium" id="titulo-calendario">
                                Calendario - Enero 2025
                            </h3>
                            <div class="flex items-center space-x-2">
                                <button onclick="navegarCalendario(-1)" class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200">
                                    ‚Üê
                                </button>
                                <button onclick="irHoyCalendario()" class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200">
                                    Hoy
                                </button>
                                <button onclick="navegarCalendario(1)" class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200">
                                    ‚Üí
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <!-- Headers de d√≠as -->
                        <div class="calendar-grid mb-2">
                            <div class="p-2 text-center text-sm font-medium text-gray-500">Dom</div>
                            <div class="p-2 text-center text-sm font-medium text-gray-500">Lun</div>
                            <div class="p-2 text-center text-sm font-medium text-gray-500">Mar</div>
                            <div class="p-2 text-center text-sm font-medium text-gray-500">Mi√©</div>
                            <div class="p-2 text-center text-sm font-medium text-gray-500">Jue</div>
                            <div class="p-2 text-center text-sm font-medium text-gray-500">Vie</div>
                            <div class="p-2 text-center text-sm font-medium text-gray-500">S√°b</div>
                        </div>
                        
                        <!-- D√≠as del calendario -->
                        <div id="calendario-dias" class="calendar-grid">
                            <!-- Se llena din√°micamente -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- B√∫squeda -->
        <div id="vista-busqueda" class="vista-contenido" style="display: none;">
            <div class="space-y-6">
                <!-- Panel de filtros -->
                <div class="bg-white p-6 rounded-lg shadow">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold">B√∫squeda y Filtros</h2>
                        <button onclick="limpiarFiltros()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 flex items-center">
                            ‚ùå Limpiar
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- B√∫squeda por texto -->
                        <div class="md:col-span-2 lg:col-span-3">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Buscar por nombre o motivo
                            </label>
                            <div class="relative">
                                <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">üîç</span>
                                <input
                                    type="text"
                                    id="busqueda-texto"
                                    placeholder="Escribe el nombre del empleado o motivo..."
                                    onkeyup="aplicarFiltros()"
                                    class="w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                />
                            </div>
                        </div>
                        
                        <!-- Filtro por empleado -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Empleado</label>
                            <select id="filtro-empleado" onchange="aplicarFiltros()" class="w-full border rounded-lg px-3 py-2">
                                <option value="">Todos los empleados</option>
                            </select>
                        </div>
                        
                        <!-- Filtro por tipo -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Tipo</label>
                            <select id="filtro-tipo" onchange="aplicarFiltros()" class="w-full border rounded-lg px-3 py-2">
                                <option value="">Todos los tipos</option>
                                <option value="adelanto">Adelanto</option>
                                <option value="prestamo">Pr√©stamo</option>
                                <option value="bono">Bono</option>
                            </select>
                        </div>
                        
                        <!-- Rango de fechas -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Fecha desde</label>
                            <input type="date" id="fecha-desde" onchange="aplicarFiltros()" class="w-full border rounded-lg px-3 py-2">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Fecha hasta</label>
                            <input type="date" id="fecha-hasta" onchange="aplicarFiltros()" class="w-full border rounded-lg px-3 py-2">
                        </div>
                        
                        <!-- Rango de montos -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Monto m√≠nimo</label>
                            <input type="number" id="monto-min" placeholder="0" onkeyup="aplicarFiltros()" class="w-full border rounded-lg px-3 py-2">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Monto m√°ximo</label>
                            <input type="number" id="monto-max" placeholder="Sin l√≠mite" onkeyup="aplicarFiltros()" class="w-full border rounded-lg px-3 py-2">
                        </div>
                    </div>
                </div>

                <!-- Resultados de b√∫squeda -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b">
                        <h3 class="text-lg font-medium">
                            Resultados de b√∫squeda (<span id="cantidad-resultados">0</span> encontrados)
                        </h3>
                        <p class="text-sm text-gray-600 mt-1">
                            Total: $<span id="total-resultados">0</span>
                        </p>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Empleado</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Monto</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivo</th>
                                </tr>
                            </thead>
                            <tbody id="tabla-resultados-busqueda" class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td colspan="5" class="px-6 py-4 text-center text-gray-500">
                                        No se encontraron adelantos que coincidan con los filtros
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empleados -->
        <div id="vista-empleados" class="vista-contenido" style="display: none;">
            <div class="space-y-6">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-xl font-semibold mb-4">Agregar Nuevo Empleado</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <input type="text" id="nuevo-empleado-nombre" placeholder="Nombre completo" class="border rounded-lg px-3 py-2">
                        <input type="text" id="nuevo-empleado-cargo" placeholder="Cargo" class="border rounded-lg px-3 py-2">
                        <input type="number" id="nuevo-empleado-salario" placeholder="Salario" class="border rounded-lg px-3 py-2">
                    </div>
                    <button onclick="agregarEmpleado()" class="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 flex items-center">
                        ‚ûï Agregar Empleado
                    </button>
                </div>

                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b">
                        <h3 class="text-lg font-medium">Lista de Empleados</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cargo</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Salario</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha Ingreso</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Adelantos</th>
                                </tr>
                            </thead>
                            <tbody id="tabla-empleados" class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td colspan="5" class="px-6 py-4 text-center text-gray-500">
                                        No hay empleados registrados
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Adelantos -->
        <div id="vista-adelantos" class="vista-contenido" style="display: none;">
            <div class="space-y-6">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-xl font-semibold mb-4">Registrar Nuevo Adelanto</h2>
                    
                    <div id="alerta-mes-cerrado-adelanto" class="bg-red-50 border border-red-200 rounded-lg p-4 mb-4" style="display: none;">
                        <div class="flex items-center">
                            <span class="text-red-600 mr-3">üîí</span>
                            <div>
                                <h3 class="text-sm font-medium text-red-800">Mes actual cerrado</h3>
                                <p class="text-sm text-red-700 mt-1">No puedes agregar adelantos porque el mes actual est√° cerrado. Re√°brelo si necesitas hacer modificaciones.</p>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <select id="adelanto-empleado" class="border rounded-lg px-3 py-2">
                            <option value="">Seleccionar empleado</option>
                        </select>
                        <input type="number" id="adelanto-monto" placeholder="Monto" class="border rounded-lg px-3 py-2">
                        <input type="date" id="adelanto-fecha" class="border rounded-lg px-3 py-2">
                        <select id="adelanto-tipo" class="border rounded-lg px-3 py-2">
                            <option value="adelanto">Adelanto</option>
                            <option value="prestamo">Pr√©stamo</option>
                            <option value="bono">Bono</option>
                        </select>
                        <input type="text" id="adelanto-motivo" placeholder="Motivo (opcional)" class="border rounded-lg px-3 py-2 md:col-span-2">
                    </div>
                    <button onclick="registrarAdelanto()" id="btn-registrar-adelanto" class="mt-4 px-6 py-2 rounded-lg flex items-center bg-green-600 text-white hover:bg-green-700">
                        ‚ûï Registrar Adelanto
                    </button>
                </div>
            </div>
        </div>

        <!-- Historial -->
        <div id="vista-historial" class="vista-contenido" style="display: none;">
            <div class="space-y-6">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-xl font-semibold mb-4">Historial de Per√≠odos Mensuales</h2>
                    
                    <div id="lista-periodos" class="grid gap-4">
                        <div class="text-center py-8 text-gray-500">
                            <div class="text-gray-300 mb-4">üìÖ</div>
                            <p>No hay per√≠odos registrados a√∫n</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuraci√≥n GitHub -->
        <div id="vista-config" class="vista-contenido" style="display: none;">
            <div class="space-y-6">
                <div class="bg-white p-6 rounded-lg shadow">
                    <h2 class="text-xl font-semibold mb-4">Configuraci√≥n de GitHub</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Token de GitHub (Personal Access Token)
                            </label>
                            <input
                                type="password"
                                id="github-token"
                                placeholder="ghp_..."
                                class="w-full border rounded-lg px-3 py-2"
                            />
                            <p class="text-xs text-gray-500 mt-1">
                                Crear en: GitHub ‚Üí Settings ‚Üí Developer settings ‚Üí Personal access tokens
                            </p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Propietario del repositorio
                                </label>
                                <input
                                    type="text"
                                    id="github-owner"
                                    placeholder="tu-usuario"
                                    class="w-full border rounded-lg px-3 py-2"
                                />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Nombre del repositorio
                                </label>
                                <input
                                    type="text"
                                    id="github-repo"
                                    placeholder="datos-adelantos"
                                    class="w-full border rounded-lg px-3 py-2"
                                />
                            </div>
                        </div>
                        <button onclick="guardarConfigGithub()" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 flex items-center">
                            üíæ Guardar Configuraci√≥n
                        </button>
                        <div id="config-github-ok" class="bg-green-50 border border-green-200 rounded-lg p-4" style="display: none;">
                            <div class="flex">
                                <span class="text-green-600 mr-3">üêô</span>
                                <div>
                                    <h3 class="text-sm font-medium text-green-800">GitHub configurado correctamente</h3>
                                    <p class="text-sm text-green-700 mt-1" id="repo-configurado">Repositorio: usuario/repo</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-lg font-semibold mb-4">Funcionalidades del Sistema</h3>
                    <div class="space-y-3 text-sm text-gray-600">
                        <div class="flex items-start">
                            <div class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium mr-3 mt-0.5">üîç</div>
                            <p><strong>B√∫squeda avanzada:</strong> Filtra por nombre, fecha, monto o tipo</p>
                        </div>
                        <div class="flex items-start">
                            <div class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium mr-3 mt-0.5">üìÖ</div>
                            <p><strong>Vista de calendario:</strong> Visualiza adelantos por fecha</p>
                        </div>
                        <div class="flex items-start">
                            <div class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium mr-3 mt-0.5">üîí</div>
                            <p><strong>Control mensual:</strong> Cierra meses para proteger datos</p>
                        </div>
                        <div class="flex items-start">
                            <div class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium mr-3 mt-0.5">üìä</div>
                            <p><strong>Estad√≠sticas:</strong> Totales separados por mes autom√°ticamente</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para adelantos seleccionados en calendario -->
    <div id="modal-calendario" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Adelantos del d√≠a</h3>
                <button onclick="cerrarModal()" class="text-gray-400 hover:text-gray-600 text-xl">&times;</button>
            </div>
            <div id="contenido-modal-calendario" class="space-y-3">
                <!-- Se llena din√°micamente -->
            </div>
            <div class="mt-4 pt-3 border-t">
                <p class="text-sm font-medium text-gray-900">
                    Total del d√≠a: $<span id="total-dia-modal">0</span>
                </p>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let empleados = JSON.parse(localStorage.getItem('empleados')) || [];
        let adelantos = JSON.parse(localStorage.getItem('adelantos')) || [];
        let periodosMensuales = JSON.parse(localStorage.getItem('periodosMensuales')) || {};
        let configGithub = JSON.parse(localStorage.getItem('configGithub')) || {
            token: '',
            repo: '',
            owner: '',
            configurado: false
        };
        
        let mesActual = localStorage.getItem('mesActual') || new Date().toISOString().slice(0, 7);
        let mesSeleccionado = mesActual;
        let vistaActual = 'dashboard';
        let vistaCalendario = false;
        let fechaCalendario = new Date();

        // Nombres de meses
        const nombresMeses = [
            'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
            'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
        ];

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            actualizarInterfaz();
            document.getElementById('adelanto-fecha').value = new Date().toISOString().split('T')[0];
        });

        // Funciones de guardado
        function guardarDatos() {
            localStorage.setItem('empleados', JSON.stringify(empleados));
            localStorage.setItem('adelantos', JSON.stringify(adelantos));
            localStorage.setItem('periodosMensuales', JSON.stringify(periodosMensuales));
            localStorage.setItem('mesActual', mesActual);
            localStorage.setItem('configGithub', JSON.stringify(configGithub));
        }

        // Cambiar vista
        function cambiarVista(nuevaVista) {
            // Ocultar todas las vistas
            document.querySelectorAll('.vista-contenido').forEach(vista => {
                vista.style.display = 'none';
            });
            
            // Resetear botones
            document.querySelectorAll('[id^="btn-"]').forEach(btn => {
                btn.className = btn.className.replace('bg-blue-600 text-white', 'bg-gray-200 text-gray-700');
            });
            
            // Mostrar vista seleccionada
            document.getElementById(`vista-${nuevaVista}`).style.display = 'block';
            document.getElementById(`btn-${nuevaVista}`).className = 
                document.getElementById(`btn-${nuevaVista}`).className.replace('bg-gray-200 text-gray-700', 'bg-blue-600 text-white');
            
            vistaActual = nuevaVista;
            
            // Actualizar contenido espec√≠fico
            if (nuevaVista === 'busqueda') {
                actualizarFiltroEmpleados();
                aplicarFiltros();
            } else if (nuevaVista === 'empleados') {
                actualizarTablaEmpleados();
            } else if (nuevaVista === 'adelantos') {
                actualizarSelectEmpleados();
                actualizarEstadoAdelantos();
            } else if (nuevaVista === 'historial') {
                actualizarHistorial();
            } else if (nuevaVista === 'config') {
                cargarConfigGithub();
            } else if (nuevaVista === 'dashboard') {
                actualizarDashboard();
            }
        }

        // Verificar si un mes est√° cerrado
        function esMesCerrado(mes) {
            return periodosMensuales[mes]?.cerrado || false;
        }

        // Cerrar mes actual
        function cerrarMesActual() {
            if (confirm(`¬øEst√°s seguro de que quieres cerrar el mes ${mesActual}? No podr√°s agregar m√°s adelantos a este per√≠odo.`)) {
                const adelantosMes = adelantos.filter(a => a.fecha.startsWith(mesActual));
                const totalMes = adelantosMes.reduce((sum, a) => sum + a.monto, 0);
                
                periodosMensuales[mesActual] = {
                    mes: mesActual,
                    cerrado: true,
                    fechaCierre: new Date().toISOString(),
                    totalAdelantos: totalMes,
                    cantidadAdelantos: adelantosMes.length,
                    adelantos: adelantosMes.map(a => a.id)
                };

                // Avanzar al siguiente mes
                const fechaActual = new Date();
                fechaActual.setMonth(fechaActual.getMonth() + 1);
                mesActual = fechaActual.toISOString().slice(0, 7);
                mesSeleccionado = mesActual;

                guardarDatos();
                actualizarInterfaz();
                alert(`Mes cerrado exitosamente. Ahora puedes trabajar en ${mesActual}`);
            }
        }

        // Reabrir mes
        function reabrirMes(mes = mesSeleccionado) {
            if (confirm(`¬øEst√°s seguro de que quieres reabrir el mes ${mes}?`)) {
                if (periodosMensuales[mes]) {
                    periodosMensuales[mes].cerrado = false;
                }
                guardarDatos();
                actualizarInterfaz();
                alert(`Mes ${mes} reabierto exitosamente`);
            }
        }

        // Agregar empleado
        function agregarEmpleado() {
            const nombre = document.getElementById('nuevo-empleado-nombre').value.trim();
            const cargo = document.getElementById('nuevo-empleado-cargo').value.trim();
            const salario = document.getElementById('nuevo-empleado-salario').value;

            if (!nombre || !cargo) {
                alert('Por favor completa nombre y cargo');
                return;
            }

            const empleado = {
                id: Date.now().toString(),
                nombre,
                cargo,
                salario: salario ? parseFloat(salario) : 0,
                fechaIngreso: new Date().toISOString().split('T')[0]
            };

            empleados.push(empleado);
            guardarDatos();

            // Limpiar formulario
            document.getElementById('nuevo-empleado-nombre').value = '';
            document.getElementById('nuevo-empleado-cargo').value = '';
            document.getElementById('nuevo-empleado-salario').value = '';

            actualizarInterfaz();
            alert('Empleado agregado exitosamente');
        }

        // Registrar adelanto
        function registrarAdelanto() {
            const empleadoId = document.getElementById('adelanto-empleado').value;
            const monto = document.getElementById('adelanto-monto').value;
            const fecha = document.getElementById('adelanto-fecha').value;
            const tipo = document.getElementById('adelanto-tipo').value;
            const motivo = document.getElementById('adelanto-motivo').value;

            if (!empleadoId || !monto) {
                alert('Por favor selecciona empleado y monto');
                return;
            }

            const mesDelAdelanto = fecha.slice(0, 7);
            
            if (esMesCerrado(mesDelAdelanto)) {
                alert(`No puedes agregar adelantos al mes ${mesDelAdelanto} porque est√° cerrado. Para modificarlo, primero debes reabrirlo.`);
                return;
            }

            const adelanto = {
                id: Date.now().toString(),
                empleadoId,
                monto: parseFloat(monto),
                fecha,
                tipo,
                motivo: motivo.trim(),
                mesRegistro: mesDelAdelanto
            };

            adelantos.push(adelanto);
            guardarDatos();

            // Limpiar formulario
            document.getElementById('adelanto-empleado').value = '';
            document.getElementById('adelanto-monto').value = '';
            document.getElementById('adelanto-fecha').value = new Date().toISOString().split('T')[0];
            document.getElementById('adelanto-tipo').value = 'adelanto';
            document.getElementById('adelanto-motivo').value = '';

            actualizarInterfaz();
            alert('Adelanto registrado exitosamente');
        }

        // Obtener nombre empleado
        function obtenerNombreEmpleado(empleadoId) {
            const empleado = empleados.find(e => e.id === empleadoId);
            return empleado ? empleado.nombre : 'Empleado no encontrado';
        }

        // Actualizar interfaz completa
        function actualizarInterfaz() {
            document.getElementById('mesActualDisplay').textContent = mesActual;
            document.getElementById('estadoMesActual').textContent = esMesCerrado(mesActual) ? '(Cerrado)' : '(Activo)';
            
            actualizarSelectorMes();
            actualizarDashboard();
            actualizarTablaEmpleados();
            actualizarSelectEmpleados();
            actualizarEstadoAdelantos();
            actualizarFiltroEmpleados();
            actualizarHistorial();
        }

        // Actualizar selector de mes
        function actualizarSelectorMes() {
            const selector = document.getElementById('selector-mes');
            const mesesConDatos = [...new Set(adelantos.map(a => a.fecha.slice(0, 7)))].sort().reverse();
            
            selector.innerHTML = `<option value="${mesActual}">üìÖ ${mesActual} (Actual)</option>`;
            
            mesesConDatos.filter(mes => mes !== mesActual).forEach(mes => {
                const icono = esMesCerrado(mes) ? 'üîí' : 'üìÇ';
                selector.innerHTML += `<option value="${mes}">${icono} ${mes}</option>`;
            });
            
            selector.value = mesSeleccionado;
        }

        // Cambiar mes seleccionado
        function cambiarMesSeleccionado() {
            mesSeleccionado = document.getElementById('selector-mes').value;
            actualizarDashboard();
        }

        // Actualizar dashboard
        function actualizarDashboard() {
            const adelantosMes = adelantos.filter(a => a.fecha.startsWith(mesSeleccionado));
            const totalMes = adelantosMes.reduce((sum, a) => sum + a.monto, 0);
            const mesesCerrados = Object.values(periodosMensuales).filter(p => p.cerrado).length;

            document.getElementById('total-mes').textContent = `$${totalMes.toLocaleString()}`;
            document.getElementById('cantidad-adelantos').textContent = adelantosMes.length;
            document.getElementById('cantidad-empleados').textContent = empleados.length;
            document.getElementById('periodos-cerrados').textContent = mesesCerrados;
            document.getElementById('mes-estadistica').textContent = mesSeleccionado;

            // Mostrar/ocultar botones seg√∫n el estado del mes
            const esCerrado = esMesCerrado(mesSeleccionado);
            const esActual = mesSeleccionado === mesActual;
            
            document.getElementById('btn-cerrar-mes').style.display = (esActual && !esCerrado) ? 'block' : 'none';
            document.getElementById('btn-reabrir-mes').style.display = esCerrado ? 'block' : 'none';

            // Mostrar alerta si est√° cerrado
            const alerta = document.getElementById('alerta-mes-cerrado');
            if (esCerrado) {
                alerta.style.display = 'block';
                const fechaCierre = periodosMensuales[mesSeleccionado]?.fechaCierre;
                document.getElementById('fecha-cierre-mes').textContent = 
                    `Cerrado: ${fechaCierre ? new Date(fechaCierre).toLocaleDateString() : 'Fecha desconocida'}`;
            } else {
                alerta.style.display = 'none';
            }

            actualizarTablaAdelantosMes();
            if (vistaCalendario) {
                actualizarCalendario();
            }
        }

        // Actualizar tabla adelantos del mes
        function actualizarTablaAdelantosMes() {
            const tbody = document.getElementById('tabla-adelantos-mes');
            const adelantosMes = adelantos.filter(a => a.fecha.startsWith(mesSeleccionado));
            
            document.getElementById('titulo-mes-lista').textContent = mesSeleccionado;
            document.getElementById('aviso-mes-cerrado-lista').style.display = esMesCerrado(mesSeleccionado) ? 'block' : 'none';

            if (adelantosMes.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-4 text-center text-gray-500">
                            No hay adelantos registrados en este mes
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = adelantosMes.map(adelanto => {
                const tipoClass = {
                    'adelanto': 'bg-blue-100 text-blue-800',
                    'prestamo': 'bg-red-100 text-red-800',
                    'bono': 'bg-green-100 text-green-800'
                }[adelanto.tipo] || 'bg-gray-100 text-gray-800';

                return `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            ${obtenerNombreEmpleado(adelanto.empleadoId)}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${adelanto.fecha}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-semibold">
                            $${adelanto.monto.toLocaleString()}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${tipoClass}">
                                ${adelanto.tipo}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-500">
                            ${adelanto.motivo || 'Sin motivo especificado'}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Toggle vista calendario
        function toggleVistaCalendario() {
            vistaCalendario = !vistaCalendario;
            document.getElementById('vista-lista').style.display = vistaCalendario ? 'none' : 'block';
            document.getElementById('vista-calendario').style.display = vistaCalendario ? 'block' : 'none';
            document.getElementById('texto-vista-calendario').textContent = vistaCalendario ? 'Lista' : 'Calendario';
            document.getElementById('btn-calendario').className = vistaCalendario ? 
                'px-4 py-2 rounded-lg flex items-center bg-indigo-600 text-white' :
                'px-4 py-2 rounded-lg flex items-center bg-gray-200 text-gray-700';
            
            if (vistaCalendario) {
                actualizarCalendario();
            }
        }

        // Actualizar calendario
        function actualizarCalendario() {
            const a√±o = fechaCalendario.getFullYear();
            const mes = fechaCalendario.getMonth();
            
            document.getElementById('titulo-calendario').textContent = 
                `Calendario - ${nombresMeses[mes]} ${a√±o}`;
            
            const primerDia = new Date(a√±o, mes, 1);
            const ultimoDia = new Date(a√±o, mes + 1, 0);
            const diasAnterior = primerDia.getDay();
            
            const dias = [];
            
            // D√≠as del mes anterior
            for (let i = diasAnterior - 1; i >= 0; i--) {
                const dia = new Date(a√±o, mes, -i);
                dias.push({ fecha: dia, esDelMes: false });
            }
            
            // D√≠as del mes actual
            for (let dia = 1; dia <= ultimoDia.getDate(); dia++) {
                const fecha = new Date(a√±o, mes, dia);
                dias.push({ fecha, esDelMes: true });
            }
            
            // D√≠as del siguiente mes para completar la grilla
            const diasRestantes = 42 - dias.length;
            for (let dia = 1; dia <= diasRestantes; dia++) {
                const fecha = new Date(a√±o, mes + 1, dia);
                dias.push({ fecha, esDelMes: false });
            }
            
            const contenedor = document.getElementById('calendario-dias');
            contenedor.innerHTML = dias.map((diaObj, index) => {
                const adelantosDia = obtenerAdelantosDelDia(diaObj.fecha);
                const totalDia = adelantosDia.reduce((sum, a) => sum + a.monto, 0);
                const esHoy = diaObj.fecha.toDateString() === new Date().toDateString();
                
                let clases = 'day-cell';
                if (!diaObj.esDelMes) clases += ' not-current-month';
                if (esHoy) clases += ' today';
                
                let contenidoAdelantos = '';
                if (adelantosDia.length > 0) {
                    contenidoAdelantos = `
                        <div class="adelanto-indicator">
                            ${adelantosDia.length} adelanto${adelantosDia.length !== 1 ? 's' : ''}
                        </div>
                        <div class="text-xs font-semibold text-green-700">
                            $${totalDia.toLocaleString()}
                        </div>
                    `;
                }
                
                return `
                    <div class="${clases}" onclick="clickDiaCalendario('${diaObj.fecha.toISOString().split('T')[0]}')">
                        <div class="text-sm font-medium mb-1">
                            ${diaObj.fecha.getDate()}
                        </div>
                        ${contenidoAdelantos}
                    </div>
                `;
            }).join('');
        }

        // Obtener adelantos del d√≠a
        function obtenerAdelantosDelDia(fecha) {
            const fechaStr = fecha.toISOString().split('T')[0];
            return adelantos.filter(adelanto => adelanto.fecha === fechaStr);
        }

        // Click en d√≠a del calendario
        function clickDiaCalendario(fecha) {
            const adelantosDia = adelantos.filter(a => a.fecha === fecha);
            if (adelantosDia.length > 0) {
                mostrarModalCalendario(adelantosDia);
            }
        }

        // Mostrar modal calendario
        function mostrarModalCalendario(adelantosDia) {
            const contenido = document.getElementById('contenido-modal-calendario');
            const totalDia = adelantosDia.reduce((sum, a) => sum + a.monto, 0);
            
            contenido.innerHTML = adelantosDia.map(adelanto => {
                const tipoClass = {
                    'adelanto': 'bg-blue-100 text-blue-800',
                    'prestamo': 'bg-red-100 text-red-800',
                    'bono': 'bg-green-100 text-green-800'
                }[adelanto.tipo] || 'bg-gray-100 text-gray-800';

                return `
                    <div class="border rounded-lg p-3">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-medium">${obtenerNombreEmpleado(adelanto.empleadoId)}</p>
                                <p class="text-sm text-gray-600">${adelanto.motivo || 'Sin motivo'}</p>
                            </div>
                            <div class="text-right">
                                <p class="font-semibold">$${adelanto.monto.toLocaleString()}</p>
                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${tipoClass}">
                                    ${adelanto.tipo}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('total-dia-modal').textContent = totalDia.toLocaleString();
            document.getElementById('modal-calendario').classList.add('show');
        }

        // Cerrar modal
        function cerrarModal() {
            document.getElementById('modal-calendario').classList.remove('show');
        }

        // Navegar calendario
        function navegarCalendario(direccion) {
            fechaCalendario.setMonth(fechaCalendario.getMonth() + direccion);
            actualizarCalendario();
        }

        // Ir a hoy en calendario
        function irHoyCalendario() {
            fechaCalendario = new Date();
            actualizarCalendario();
        }

        // Actualizar tabla empleados
        function actualizarTablaEmpleados() {
            const tbody = document.getElementById('tabla-empleados');
            
            if (empleados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-4 text-center text-gray-500">
                            No hay empleados registrados
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = empleados.map(empleado => {
                const adelantosEmpleado = adelantos.filter(a => a.empleadoId === empleado.id);
                const totalEmpleado = adelantosEmpleado.reduce((sum, a) => sum + a.monto, 0);
                
                return `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            ${empleado.nombre}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${empleado.cargo}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${empleado.salario ? `$${empleado.salario.toLocaleString()}` : 'No especificado'}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${empleado.fechaIngreso}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            $${totalEmpleado.toLocaleString()} (${adelantosEmpleado.length})
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Actualizar select empleados
        function actualizarSelectEmpleados() {
            const select = document.getElementById('adelanto-empleado');
            select.innerHTML = '<option value="">Seleccionar empleado</option>';
            
            empleados.forEach(empleado => {
                select.innerHTML += `<option value="${empleado.id}">${empleado.nombre} - ${empleado.cargo}</option>`;
            });
        }

        // Actualizar estado adelantos
        function actualizarEstadoAdelantos() {
            const esCerrado = esMesCerrado(mesActual);
            const alerta = document.getElementById('alerta-mes-cerrado-adelanto');
            const btn = document.getElementById('btn-registrar-adelanto');
            const campos = ['adelanto-empleado', 'adelanto-monto', 'adelanto-fecha', 'adelanto-tipo', 'adelanto-motivo'];
            
            alerta.style.display = esCerrado ? 'block' : 'none';
            
            campos.forEach(id => {
                document.getElementById(id).disabled = esCerrado;
            });
            
            if (esCerrado) {
                btn.className = 'mt-4 px-6 py-2 rounded-lg flex items-center bg-gray-400 text-gray-700 cursor-not-allowed';
                btn.disabled = true;
            } else {
                btn.className = 'mt-4 px-6 py-2 rounded-lg flex items-center bg-green-600 text-white hover:bg-green-700';
                btn.disabled = false;
            }
        }

        // Actualizar filtro empleados en b√∫squeda
        function actualizarFiltroEmpleados() {
            const select = document.getElementById('filtro-empleado');
            select.innerHTML = '<option value="">Todos los empleados</option>';
            
            empleados.forEach(empleado => {
                select.innerHTML += `<option value="${empleado.id}">${empleado.nombre}</option>`;
            });
        }

        // Aplicar filtros de b√∫squeda
        function aplicarFiltros() {
            const texto = document.getElementById('busqueda-texto').value.toLowerCase();
            const empleadoId = document.getElementById('filtro-empleado').value;
            const tipo = document.getElementById('filtro-tipo').value;
            const fechaDesde = document.getElementById('fecha-desde').value;
            const fechaHasta = document.getElementById('fecha-hasta').value;
            const montoMin = parseFloat(document.getElementById('monto-min').value) || 0;
            const montoMax = parseFloat(document.getElementById('monto-max').value) || Infinity;

            const adelantosFiltrados = adelantos.filter(adelanto => {
                const empleado = empleados.find(e => e.id === adelanto.empleadoId);
                const nombreEmpleado = empleado ? empleado.nombre.toLowerCase() : '';
                
                // Filtros
                if (texto && !nombreEmpleado.includes(texto) && !adelanto.motivo.toLowerCase().includes(texto)) return false;
                if (empleadoId && adelanto.empleadoId !== empleadoId) return false;
                if (tipo && adelanto.tipo !== tipo) return false;
                if (fechaDesde && adelanto.fecha < fechaDesde) return false;
                if (fechaHasta && adelanto.fecha > fechaHasta) return false;
                if (adelanto.monto < montoMin || adelanto.monto > montoMax) return false;
                
                return true;
            });

            const totalResultados = adelantosFiltrados.reduce((sum, a) => sum + a.monto, 0);
            
            document.getElementById('cantidad-resultados').textContent = adelantosFiltrados.length;
            document.getElementById('total-resultados').textContent = totalResultados.toLocaleString();

            const tbody = document.getElementById('tabla-resultados-busqueda');
            
            if (adelantosFiltrados.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-4 text-center text-gray-500">
                            No se encontraron adelantos que coincidan con los filtros
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = adelantosFiltrados.map(adelanto => {
                const tipoClass = {
                    'adelanto': 'bg-blue-100 text-blue-800',
                    'prestamo': 'bg-red-100 text-red-800',
                    'bono': 'bg-green-100 text-green-800'
                }[adelanto.tipo] || 'bg-gray-100 text-gray-800';

                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            ${obtenerNombreEmpleado(adelanto.empleadoId)}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            ${adelanto.fecha}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-semibold">
                            $${adelanto.monto.toLocaleString()}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${tipoClass}">
                                ${adelanto.tipo}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-500">
                            ${adelanto.motivo || 'Sin motivo especificado'}
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Limpiar filtros
        function limpiarFiltros() {
            document.getElementById('busqueda-texto').value = '';
            document.getElementById('filtro-empleado').value = '';
            document.getElementById('filtro-tipo').value = '';
            document.getElementById('fecha-desde').value = '';
            document.getElementById('fecha-hasta').value = '';
            document.getElementById('monto-min').value = '';
            document.getElementById('monto-max').value = '';
            aplicarFiltros();
        }

        // Actualizar historial
        function actualizarHistorial() {
            const contenedor = document.getElementById('lista-periodos');
            const mesesConDatos = [...new Set(adelantos.map(a => a.fecha.slice(0, 7)))].sort().reverse();
            
            if (mesesConDatos.length === 0) {
                contenedor.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-gray-300 mb-4">üìÖ</div>
                        <p>No hay per√≠odos registrados a√∫n</p>
                    </div>
                `;
                return;
            }

            contenedor.innerHTML = mesesConDatos.map(mes => {
                const adelantosMes = adelantos.filter(a => a.fecha.startsWith(mes));
                const totalMes = adelantosMes.reduce((sum, a) => sum + a.monto, 0);
                const periodo = periodosMensuales[mes];
                const cerrado = esMesCerrado(mes);
                
                const colorClass = cerrado ? 'border-orange-200 bg-orange-50' : 'border-green-200 bg-green-50';
                const icono = cerrado ? 'üîí' : 'üîì';
                
                let fechaCierre = '';
                if (periodo && cerrado) {
                    fechaCierre = `<p class="text-xs text-gray-500">Cerrado: ${new Date(periodo.fechaCierre).toLocaleDateString()}</p>`;
                }
                
                return `
                    <div class="p-4 rounded-lg border-2 ${colorClass}">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center">
                                <span class="mr-3">${icono}</span>
                                <div>
                                    <h3 class="text-lg font-medium text-gray-900">${mes}</h3>
                                    <p class="text-sm text-gray-600">
                                        ${adelantosMes.length} adelantos ‚Ä¢ $${totalMes.toLocaleString()}
                                    </p>
                                    ${fechaCierre}
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="verMes('${mes}')" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 flex items-center">
                                    üëÅÔ∏è Ver
                                </button>
                                ${cerrado ? `<button onclick="reabrirMes('${mes}')" class="bg-yellow-600 text-white px-3 py-1 rounded text-sm hover:bg-yellow-700 flex items-center">üîì Reabrir</button>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Ver mes espec√≠fico
        function verMes(mes) {
            mesSeleccionado = mes;
            cambiarVista('dashboard');
        }

        // Cargar configuraci√≥n GitHub
        function cargarConfigGithub() {
            document.getElementById('github-token').value = configGithub.token || '';
            document.getElementById('github-owner').value = configGithub.owner || '';
            document.getElementById('github-repo').value = configGithub.repo || '';
            
            if (configGithub.configurado) {
                document.getElementById('config-github-ok').style.display = 'block';
                document.getElementById('repo-configurado').textContent = `Repositorio: ${configGithub.owner}/${configGithub.repo}`;
            } else {
                document.getElementById('config-github-ok').style.display = 'none';
            }
        }

        // Guardar configuraci√≥n GitHub
        function guardarConfigGithub() {
            const token = document.getElementById('github-token').value.trim();
            const owner = document.getElementById('github-owner').value.trim();
            const repo = document.getElementById('github-repo').value.trim();

            if (!token || !owner || !repo) {
                alert('Por favor completa todos los campos de configuraci√≥n');
                return;
            }

            configGithub = {
                token,
                owner,
                repo,
                configurado: true
            };

            guardarDatos();
            cargarConfigGithub();
            alert('GitHub configurado correctamente');
        }

        // Sincronizar con GitHub
        async function sincronizarGithub() {
            if (!configGithub.configurado) {
                alert('Primero configura GitHub en la pesta√±a GitHub');
                return;
            }

            const datos = {
                empleados,
                adelantos,
                periodosMensuales,
                mesActual,
                ultimaActualizacion: new Date().toISOString()
            };

            const contenido = btoa(JSON.stringify(datos, null, 2));
            const fecha = new Date().toISOString().split('T')[0];
            
            try {
                // Intentar obtener el archivo existente para obtener el SHA
                let sha = null;
                try {
                    const getResponse = await fetch(`https://api.github.com/repos/${configGithub.owner}/${configGithub.repo}/contents/adelantos-data.json`, {
                        headers: {
                            'Authorization': `token ${configGithub.token}`,
                        }
                    });
                    if (getResponse.ok) {
                        const existingFile = await getResponse.json();
                        sha = existingFile.sha;
                    }
                } catch (e) {
                    console.log('Archivo no existe, se crear√° uno nuevo');
                }

                const requestBody = {
                    message: `Actualizaci√≥n adelantos ${fecha} - Mes actual: ${mesActual}`,
                    content: contenido,
                };

                if (sha) {
                    requestBody.sha = sha;
                }

                const response = await fetch(`https://api.github.com/repos/${configGithub.owner}/${configGithub.repo}/contents/adelantos-data.json`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${configGithub.token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                if (response.ok) {
                    alert('‚úÖ Datos sincronizados con GitHub exitosamente');
                } else {
                    const errorData = await response.json();
                    alert(`‚ùå Error al sincronizar: ${errorData.message}`);
                }
            } catch (error) {
                alert(`‚ùå Error de conexi√≥n: ${error.message}`);
            }
        }

        // Exportar datos
        function exportarDatos() {
            const adelantosMes = adelantos.filter(a => a.fecha.startsWith(mesSeleccionado));
            const totalMes = adelantosMes.reduce((sum, a) => sum + a.monto, 0);
            
            const datos = {
                mes: mesSeleccionado,
                empleados,
                adelantos: adelantosMes,
                periodo: periodosMensuales[mesSeleccionado] || null,
                resumen: {
                    totalMes,
                    totalAdelantos: adelantosMes.length,
                    cerrado: esMesCerrado(mesSeleccionado)
                },
                fechaExportacion: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(datos, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `adelantos-${mesSeleccionado}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        // Cerrar modal al hacer clic fuera
        document.getElementById('modal-calendario').addEventListener('click', function(e) {
            if (e.target === this) {
                cerrarModal();
            }
        });
    </script>
</body>
</html>
