import React, { useState, useEffect } from 'react';
import { Plus, Users, DollarSign, Calendar, Github, Save, Download, Eye, Lock, Unlock, Archive, Search, Filter, X, ChevronLeft, ChevronRight } from 'lucide-react';

const SistemaAdelantos = () => {
  const [empleados, setEmpleados] = useState([]);
  const [adelantos, setAdelantos] = useState([]);
  const [periodosMensuales, setPeriodosMensuales] = useState({});
  const [vistaActual, setVistaActual] = useState('dashboard');
  const [configGithub, setConfigGithub] = useState({
    token: '',
    repo: '',
    owner: '',
    configurado: false
  });

  // Estados para b√∫squeda y filtros
  const [busqueda, setBusqueda] = useState({
    texto: '',
    empleadoId: '',
    fechaInicio: '',
    fechaFin: '',
    tipo: '',
    montoMin: '',
    montoMax: ''
  });

  // Estados para calendario
  const [vistaCalendario, setVistaCalendario] = useState(false);
  const [fechaCalendario, setFechaCalendario] = useState(new Date());
  const [adelantoSeleccionado, setAdelantoSeleccionado] = useState(null);

  // Estados para formularios
  const [nuevoEmpleado, setNuevoEmpleado] = useState({
    nombre: '',
    cargo: '',
    salario: '',
    id: ''
  });

  const [nuevoAdelanto, setNuevoAdelanto] = useState({
    empleadoId: '',
    monto: '',
    fecha: new Date().toISOString().split('T')[0],
    motivo: '',
    tipo: 'adelanto'
  });

  const [mesActual, setMesActual] = useState(new Date().toISOString().slice(0, 7));
  const [mesSeleccionado, setMesSeleccionado] = useState(new Date().toISOString().slice(0, 7));

  // Cargar datos desde localStorage al iniciar
  useEffect(() => {
    const empleadosGuardados = localStorage.getItem('empleados');
    const adelantosGuardados = localStorage.getItem('adelantos');
    const periodosGuardados = localStorage.getItem('periodosMensuales');
    const configGuardada = localStorage.getItem('configGithub');
    const mesActualGuardado = localStorage.getItem('mesActual');
    
    if (empleadosGuardados) {
      setEmpleados(JSON.parse(empleadosGuardados));
    }
    if (adelantosGuardados) {
      setAdelantos(JSON.parse(adelantosGuardados));
    }
    if (periodosGuardados) {
      setPeriodosMensuales(JSON.parse(periodosGuardados));
    }
    if (configGuardada) {
      setConfigGithub(JSON.parse(configGuardada));
    }
    if (mesActualGuardado) {
      setMesActual(mesActualGuardado);
      setMesSeleccionado(mesActualGuardado);
    }
  }, []);

  // Guardar en localStorage cuando cambien los datos
  useEffect(() => {
    localStorage.setItem('empleados', JSON.stringify(empleados));
  }, [empleados]);

  useEffect(() => {
    localStorage.setItem('adelantos', JSON.stringify(adelantos));
  }, [adelantos]);

  useEffect(() => {
    localStorage.setItem('periodosMensuales', JSON.stringify(periodosMensuales));
  }, [periodosMensuales]);

  useEffect(() => {
    localStorage.setItem('mesActual', mesActual);
  }, [mesActual]);

  // Funci√≥n de b√∫squeda y filtrado
  const filtrarAdelantos = (adelantosBase = adelantos) => {
    return adelantosBase.filter(adelanto => {
      const empleado = empleados.find(e => e.id === adelanto.empleadoId);
      const nombreEmpleado = empleado ? empleado.nombre.toLowerCase() : '';
      
      // Filtro por texto (busca en nombre y motivo)
      if (busqueda.texto && 
          !nombreEmpleado.includes(busqueda.texto.toLowerCase()) && 
          !adelanto.motivo.toLowerCase().includes(busqueda.texto.toLowerCase())) {
        return false;
      }
      
      // Filtro por empleado espec√≠fico
      if (busqueda.empleadoId && adelanto.empleadoId !== busqueda.empleadoId) {
        return false;
      }
      
      // Filtro por fecha inicio
      if (busqueda.fechaInicio && adelanto.fecha < busqueda.fechaInicio) {
        return false;
      }
      
      // Filtro por fecha fin
      if (busqueda.fechaFin && adelanto.fecha > busqueda.fechaFin) {
        return false;
      }
      
      // Filtro por tipo
      if (busqueda.tipo && adelanto.tipo !== busqueda.tipo) {
        return false;
      }
      
      // Filtro por monto m√≠nimo
      if (busqueda.montoMin && adelanto.monto < parseFloat(busqueda.montoMin)) {
        return false;
      }
      
      // Filtro por monto m√°ximo
      if (busqueda.montoMax && adelanto.monto > parseFloat(busqueda.montoMax)) {
        return false;
      }
      
      return true;
    });
  };

  // Limpiar filtros
  const limpiarFiltros = () => {
    setBusqueda({
      texto: '',
      empleadoId: '',
      fechaInicio: '',
      fechaFin: '',
      tipo: '',
      montoMin: '',
      montoMax: ''
    });
  };

  // Funciones del calendario
  const obtenerDiasDelMes = (fecha) => {
    const a√±o = fecha.getFullYear();
    const mes = fecha.getMonth();
    const primerDia = new Date(a√±o, mes, 1);
    const ultimoDia = new Date(a√±o, mes + 1, 0);
    const diasAnterior = primerDia.getDay();
    
    const dias = [];
    
    // D√≠as del mes anterior
    for (let i = diasAnterior - 1; i >= 0; i--) {
      const dia = new Date(a√±o, mes, -i);
      dias.push({ fecha: dia, esDelMes: false });
    }
    
    // D√≠as del mes actual
    for (let dia = 1; dia <= ultimoDia.getDate(); dia++) {
      const fecha = new Date(a√±o, mes, dia);
      dias.push({ fecha, esDelMes: true });
    }
    
    // D√≠as del siguiente mes para completar la grilla
    const diasRestantes = 42 - dias.length;
    for (let dia = 1; dia <= diasRestantes; dia++) {
      const fecha = new Date(a√±o, mes + 1, dia);
      dias.push({ fecha, esDelMes: false });
    }
    
    return dias;
  };

  const obtenerAdelantosDelDia = (fecha) => {
    const fechaStr = fecha.toISOString().split('T')[0];
    return adelantos.filter(adelanto => adelanto.fecha === fechaStr);
  };

  const navegarMesCalendario = (direccion) => {
    const nuevaFecha = new Date(fechaCalendario);
    nuevaFecha.setMonth(nuevaFecha.getMonth() + direccion);
    setFechaCalendario(nuevaFecha);
  };

  // Verificar si un mes est√° cerrado
  const esMesCerrado = (mes) => {
    return periodosMensuales[mes]?.cerrado || false;
  };

  // Cerrar mes actual y crear nuevo per√≠odo
  const cerrarMesActual = () => {
    if (window.confirm(`¬øEst√°s seguro de que quieres cerrar el mes ${mesActual}? No podr√°s agregar m√°s adelantos a este per√≠odo.`)) {
      const adelantosMes = adelantos.filter(a => a.fecha.startsWith(mesActual));
      const totalMes = adelantosMes.reduce((sum, a) => sum + a.monto, 0);
      
      const nuevoPeriodo = {
        mes: mesActual,
        cerrado: true,
        fechaCierre: new Date().toISOString(),
        totalAdelantos: totalMes,
        cantidadAdelantos: adelantosMes.length,
        adelantos: adelantosMes.map(a => a.id)
      };

      setPeriodosMensuales(prev => ({
        ...prev,
        [mesActual]: nuevoPeriodo
      }));

      // Avanzar al siguiente mes
      const fechaActual = new Date();
      fechaActual.setMonth(fechaActual.getMonth() + 1);
      const nuevoMes = fechaActual.toISOString().slice(0, 7);
      setMesActual(nuevoMes);
      setMesSeleccionado(nuevoMes);

      alert(`Mes ${mesActual} cerrado exitosamente. Ahora puedes trabajar en ${nuevoMes}`);
    }
  };

  // Reabrir un mes cerrado
  const reabrirMes = (mes) => {
    if (window.confirm(`¬øEst√°s seguro de que quieres reabrir el mes ${mes}?`)) {
      setPeriodosMensuales(prev => ({
        ...prev,
        [mes]: { ...prev[mes], cerrado: false }
      }));
      alert(`Mes ${mes} reabierto exitosamente`);
    }
  };

  // Funciones para GitHub
  const configurarGithub = () => {
    if (configGithub.token && configGithub.repo && configGithub.owner) {
      const nuevaConfig = { ...configGithub, configurado: true };
      setConfigGithub(nuevaConfig);
      localStorage.setItem('configGithub', JSON.stringify(nuevaConfig));
      alert('GitHub configurado correctamente');
    } else {
      alert('Por favor completa todos los campos de configuraci√≥n');
    }
  };

  const sincronizarConGithub = async () => {
    if (!configGithub.configurado) {
      alert('Primero configura GitHub en la secci√≥n de configuraci√≥n');
      return;
    }

    const datos = {
      empleados,
      adelantos,
      periodosMensuales,
      mesActual,
      ultimaActualizacion: new Date().toISOString()
    };

    const contenido = btoa(JSON.stringify(datos, null, 2));
    const fecha = new Date().toISOString().split('T')[0];
    
    try {
      // Intentar obtener el archivo existente para obtener el SHA
      let sha = null;
      try {
        const getResponse = await fetch(`https://api.github.com/repos/${configGithub.owner}/${configGithub.repo}/contents/adelantos-data.json`, {
          headers: {
            'Authorization': `token ${configGithub.token}`,
          }
        });
        if (getResponse.ok) {
          const existingFile = await getResponse.json();
          sha = existingFile.sha;
        }
      } catch (e) {
        // El archivo no existe, se crear√° uno nuevo
      }

      const requestBody = {
        message: `Actualizaci√≥n adelantos ${fecha} - Mes actual: ${mesActual}`,
        content: contenido,
      };

      if (sha) {
        requestBody.sha = sha;
      }

      const response = await fetch(`https://api.github.com/repos/${configGithub.owner}/${configGithub.repo}/contents/adelantos-data.json`, {
        method: 'PUT',
        headers: {
          'Authorization': `token ${configGithub.token}`,
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(requestBody)
      });

      if (response.ok) {
        alert('Datos sincronizados con GitHub exitosamente');
      } else {
        const errorData = await response.json();
        alert(`Error al sincronizar: ${errorData.message}`);
      }
    } catch (error) {
      alert(`Error de conexi√≥n: ${error.message}`);
    }
  };

  // Funciones para empleados
  const agregarEmpleado = () => {
    if (!nuevoEmpleado.nombre || !nuevoEmpleado.cargo) {
      alert('Por favor completa nombre y cargo');
      return;
    }

    const empleado = {
      ...nuevoEmpleado,
      id: Date.now().toString(),
      fechaIngreso: new Date().toISOString().split('T')[0]
    };

    setEmpleados([...empleados, empleado]);
    setNuevoEmpleado({ nombre: '', cargo: '', salario: '', id: '' });
  };

  // Funciones para adelantos
  const agregarAdelanto = () => {
    if (!nuevoAdelanto.empleadoId || !nuevoAdelanto.monto) {
      alert('Por favor selecciona empleado y monto');
      return;
    }

    const mesDelAdelanto = nuevoAdelanto.fecha.slice(0, 7);
    
    // Verificar si el mes est√° cerrado
    if (esMesCerrado(mesDelAdelanto)) {
      alert(`No puedes agregar adelantos al mes ${mesDelAdelanto} porque est√° cerrado. Para modificarlo, primero debes reabrirlo.`);
      return;
    }

    const adelanto = {
      ...nuevoAdelanto,
      id: Date.now().toString(),
      monto: parseFloat(nuevoAdelanto.monto),
      mesRegistro: mesDelAdelanto
    };

    setAdelantos([...adelantos, adelanto]);
    setNuevoAdelanto({
      empleadoId: '',
      monto: '',
      fecha: new Date().toISOString().split('T')[0],
      motivo: '',
      tipo: 'adelanto'
    });

    alert('Adelanto registrado exitosamente');
  };

  // Aplicar filtros a adelantos
  const adelantosFiltrados = filtrarAdelantos();
  const adelantosMesSeleccionado = adelantosFiltrados.filter(adelanto => 
    adelanto.fecha.startsWith(mesSeleccionado)
  );

  // Calcular totales del mes seleccionado
  const totalMesSeleccionado = adelantosMesSeleccionado.reduce((sum, a) => sum + a.monto, 0);

  // Obtener todos los meses √∫nicos con datos
  const mesesConDatos = [...new Set(adelantos.map(a => a.fecha.slice(0, 7)))].sort().reverse();

  // Funci√≥n para exportar datos del mes
  const exportarDatosMes = () => {
    const datos = {
      mes: mesSeleccionado,
      empleados,
      adelantos: adelantosMesSeleccionado,
      periodo: periodosMensuales[mesSeleccionado] || null,
      resumen: {
        totalMes: totalMesSeleccionado,
        totalAdelantos: adelantosMesSeleccionado.length,
        cerrado: esMesCerrado(mesSeleccionado)
      },
      fechaExportacion: new Date().toISOString()
    };
    
    const dataStr = JSON.stringify(datos, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `adelantos-${mesSeleccionado}.json`;
    link.click();
  };

  const obtenerNombreEmpleado = (empleadoId) => {
    const empleado = empleados.find(e => e.id === empleadoId);
    return empleado ? empleado.nombre : 'Empleado no encontrado';
  };

  // Calcular estad√≠sticas generales
  const totalGeneral = adelantos.reduce((sum, a) => sum + a.monto, 0);
  const mesesCerrados = Object.values(periodosMensuales).filter(p => p.cerrado).length;

  // Nombres de meses para el calendario
  const nombresMeses = [
    'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
    'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
  ];

  const nombresDias = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Header */}
      <div className="bg-white shadow-sm border-b">
        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div className="flex justify-between items-center py-4">
            <div>
              <h1 className="text-2xl font-bold text-gray-900">Sistema de Adelantos</h1>
              <p className="text-sm text-gray-600">Mes actual: {mesActual} {esMesCerrado(mesActual) ? '(Cerrado)' : '(Activo)'}</p>
            </div>
            <div className="flex space-x-2">
              <button
                onClick={() => setVistaActual('dashboard')}
                className={`px-4 py-2 rounded-lg ${vistaActual === 'dashboard' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}
              >
                <Calendar className="w-4 h-4 inline mr-2" />
                Dashboard
              </button>
              <button
                onClick={() => setVistaActual('busqueda')}
                className={`px-4 py-2 rounded-lg ${vistaActual === 'busqueda' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}
              >
                <Search className="w-4 h-4 inline mr-2" />
                B√∫squeda
              </button>
              <button
                onClick={() => setVistaActual('empleados')}
                className={`px-4 py-2 rounded-lg ${vistaActual === 'empleados' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}
              >
                <Users className="w-4 h-4 inline mr-2" />
                Empleados
              </button>
              <button
                onClick={() => setVistaActual('adelantos')}
                className={`px-4 py-2 rounded-lg ${vistaActual === 'adelantos' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}
              >
                <DollarSign className="w-4 h-4 inline mr-2" />
                Adelantos
              </button>
              <button
                onClick={() => setVistaActual('historial')}
                className={`px-4 py-2 rounded-lg ${vistaActual === 'historial' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}
              >
                <Archive className="w-4 h-4 inline mr-2" />
                Historial
              </button>
              <button
                onClick={() => setVistaActual('config')}
                className={`px-4 py-2 rounded-lg ${vistaActual === 'config' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}
              >
                <Github className="w-4 h-4 inline mr-2" />
                GitHub
              </button>
            </div>
          </div>
        </div>
      </div>

      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Dashboard */}
        {vistaActual === 'dashboard' && (
          <div className="space-y-6">
            {/* Control de mes y acciones principales */}
            <div className="bg-white p-6 rounded-lg shadow">
              <div className="flex justify-between items-center mb-4">
                <h2 className="text-xl font-semibold">Panel de Control Mensual</h2>
                <div className="flex space-x-3">
                  <select
                    value={mesSeleccionado}
                    onChange={(e) => setMesSeleccionado(e.target.value)}
                    className="border rounded-lg px-3 py-2"
                  >
                    <option value={mesActual}>üìÖ {mesActual} (Actual)</option>
                    {mesesConDatos.filter(mes => mes !== mesActual).map(mes => (
                      <option key={mes} value={mes}>
                        {esMesCerrado(mes) ? 'üîí' : 'üìÇ'} {mes}
                      </option>
                    ))}
                  </select>
                  
                  <button
                    onClick={() => setVistaCalendario(!vistaCalendario)}
                    className={`px-4 py-2 rounded-lg flex items-center ${
                      vistaCalendario ? 'bg-indigo-600 text-white' : 'bg-gray-200 text-gray-700'
                    }`}
                  >
                    <Calendar className="w-4 h-4 mr-2" />
                    {vistaCalendario ? 'Lista' : 'Calendario'}
                  </button>
                  
                  {mesSeleccionado === mesActual && !esMesCerrado(mesActual) && (
                    <button
                      onClick={cerrarMesActual}
                      className="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 flex items-center"
                    >
                      <Lock className="w-4 h-4 mr-2" />
                      Cerrar Mes
                    </button>
                  )}
                  
                  {esMesCerrado(mesSeleccionado) && (
                    <button
                      onClick={() => reabrirMes(mesSeleccionado)}
                      className="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 flex items-center"
                    >
                      <Unlock className="w-4 h-4 mr-2" />
                      Reabrir
                    </button>
                  )}
                  
                  <button
                    onClick={exportarDatosMes}
                    className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center"
                  >
                    <Download className="w-4 h-4 mr-2" />
                    Exportar
                  </button>
                  <button
                    onClick={sincronizarConGithub}
                    className="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 flex items-center"
                  >
                    <Save className="w-4 h-4 mr-2" />
                    Sincronizar
                  </button>
                </div>
              </div>

              {/* Estado del mes seleccionado */}
              {esMesCerrado(mesSeleccionado) && (
                <div className="bg-orange-50 border border-orange-200 rounded-lg p-4 mb-4">
                  <div className="flex items-center">
                    <Lock className="w-5 h-5 text-orange-600" />
                    <div className="ml-3">
                      <h3 className="text-sm font-medium text-orange-800">
                        Mes cerrado: {mesSeleccionado}
                      </h3>
                      <p className="text-sm text-orange-700 mt-1">
                        Fecha de cierre: {periodosMensuales[mesSeleccionado]?.fechaCierre ? 
                          new Date(periodosMensuales[mesSeleccionado].fechaCierre).toLocaleDateString() : 'No disponible'}
                      </p>
                    </div>
                  </div>
                </div>
              )}

              {/* Estad√≠sticas del mes seleccionado */}
              <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div className="bg-blue-50 p-4 rounded-lg">
                  <div className="flex items-center">
                    <DollarSign className="w-8 h-8 text-blue-600" />
                    <div className="ml-4">
                      <p className="text-sm font-medium text-blue-600">Total del Mes</p>
                      <p className="text-2xl font-bold text-blue-900">${totalMesSeleccionado.toLocaleString()}</p>
                      <p className="text-xs text-blue-700">{mesSeleccionado}</p>
                    </div>
                  </div>
                </div>
                <div className="bg-green-50 p-4 rounded-lg">
                  <div className="flex items-center">
                    <Calendar className="w-8 h-8 text-green-600" />
                    <div className="ml-4">
                      <p className="text-sm font-medium text-green-600">Adelantos</p>
                      <p className="text-2xl font-bold text-green-900">{adelantosMesSeleccionado.length}</p>
                      <p className="text-xs text-green-700">Transacciones</p>
                    </div>
                  </div>
                </div>
                <div className="bg-purple-50 p-4 rounded-lg">
                  <div className="flex items-center">
                    <Users className="w-8 h-8 text-purple-600" />
                    <div className="ml-4">
                      <p className="text-sm font-medium text-purple-600">Empleados</p>
                      <p className="text-2xl font-bold text-purple-900">{empleados.length}</p>
                      <p className="text-xs text-purple-700">Registrados</p>
                    </div>
                  </div>
                </div>
                <div className="bg-orange-50 p-4 rounded-lg">
                  <div className="flex items-center">
                    <Archive className="w-8 h-8 text-orange-600" />
                    <div className="ml-4">
                      <p className="text-sm font-medium text-orange-600">Per√≠odos</p>
                      <p className="text-2xl font-bold text-orange-900">{mesesCerrados}</p>
                      <p className="text-xs text-orange-700">Cerrados</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {/* Vista de Calendario o Lista */}
            {vistaCalendario ? (
              <div className="bg-white rounded-lg shadow">
                <div className="px-6 py-4 border-b">
                  <div className="flex justify-between items-center">
                    <h3 className="text-lg font-medium">
                      Calendario - {nombresMeses[fechaCalendario.getMonth()]} {fechaCalendario.getFullYear()}
                    </h3>
                    <div className="flex items-center space-x-2">
                      <button
                        onClick={() => navegarMesCalendario(-1)}
                        className="p-2 rounded-lg bg-gray-100 hover:bg-gray-200"
                      >
                        <ChevronLeft className="w-4 h-4" />
                      </button>
                      <button
                        onClick={() => setFechaCalendario(new Date())}
                        className="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200"
                      >
                        Hoy
                      </button>
                      <button
                        onClick={() => navegarMesCalendario(1)}
                        className="p-2 rounded-lg bg-gray-100 hover:bg-gray-200"
                      >
                        <ChevronRight className="w-4 h-4" />
                      </button>
                    </div>
                  </div>
                </div>
                
                <div className="p-6">
                  {/* Headers de d√≠as */}
                  <div className="grid grid-cols-7 gap-1 mb-2">
                    {nombresDias.map(dia => (
                      <div key={dia} className="p-2 text-center text-sm font-medium text-gray-500">
                        {dia}
                      </div>
                    ))}
                  </div>
                  
                  {/* D√≠as del calendario */}
                  <div className="grid grid-cols-7 gap-1">
                    {obtenerDiasDelMes(fechaCalendario).map((diaObj, index) => {
                      const adelantosDia = obtenerAdelantosDelDia(diaObj.fecha);
                      const totalDia = adelantosDia.reduce((sum, a) => sum + a.monto, 0);
                      const esHoy = diaObj.fecha.toDateString() === new Date().toDateString();
                      
                      return (
                        <div
                          key={index}
                          className={`min-h-[80px] p-1 border rounded-lg cursor-pointer hover:bg-gray-50 ${
                            !diaObj.esDelMes ? 'bg-gray-100 text-gray-400' : 'bg-white'
                          } ${esHoy ? 'border-blue-500 bg-blue-50' : 'border-gray-200'}`}
                          onClick={() => {
                            if (adelantosDia.length > 0) {
                              setAdelantoSeleccionado(adelantosDia);
                            }
                          }}
                        >
                          <div className="text-sm font-medium mb-1">
                            {diaObj.fecha.getDate()}
                          </div>
                          {adelantosDia.length > 0 && (
                            <div className="space-y-1">
                              <div className="text-xs bg-blue-100 text-blue-800 rounded px-1 py-0.5">
                                {adelantosDia.length} adelanto{adelantosDia.length !== 1 ? 's' : ''}
                              </div>
                              <div className="text-xs font-semibold text-green-700">
                                ${totalDia.toLocaleString()}
                              </div>
                            </div>
                          )}
                        </div>
                      );
                    })}
                  </div>
                </div>
              </div>
            ) : (
              /* Lista de adelantos del mes seleccionado */
              <div className="bg-white rounded-lg shadow">
                <div className="px-6 py-4 border-b">
                  <h3 className="text-lg font-medium">Adelantos de {mesSeleccionado}</h3>
                  {esMesCerrado(mesSeleccionado) && (
                    <p className="text-sm text-orange-600 mt-1">‚ö†Ô∏è Este mes est√° cerrado - Solo lectura</p>
                  )}
                </div>
                <div className="overflow-x-auto">
                  <table className="min-w-full divide-y divide-gray-200">
                    <thead className="bg-gray-50">
                      <tr>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Empleado</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Monto</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivo</th>
                      </tr>
                    </thead>
                    <tbody className="bg-white divide-y divide-gray-200">
                      {adelantosMesSeleccionado.length === 0 ? (
                        <tr>
                          <td colSpan="5" className="px-6 py-4 text-center text-gray-500">
                            No hay adelantos registrados en este mes
                          </td>
                        </tr>
                      ) : (
                        adelantosMesSeleccionado.map((adelanto) => (
                          <tr key={adelanto.id}>
                            <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                              {obtenerNombreEmpleado(adelanto.empleadoId)}
                            </td>
                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                              {adelanto.fecha}
                            </td>
                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-semibold">
                              ${adelanto.monto.toLocaleString()}
                            </td>
                            <td className="px-6 py-4 whitespace-nowrap">
                              <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                                adelanto.tipo === 'adelanto' ? 'bg-blue-100 text-blue-800' :
                                adelanto.tipo === 'prestamo' ? 'bg-red-100 text-red-800' :
                                'bg-green-100 text-green-800'
                              }`}>
                                {adelanto.tipo}
                              </span>
                            </td>
                            <td className="px-6 py-4 text-sm text-gray-500">
                              {adelanto.motivo || 'Sin motivo especificado'}
                            </td>
                          </tr>
                        ))
                      )}
                    </tbody>
                  </table>
                </div>
              </div>
            )}
          </div>
        )}

        {/* B√∫squeda y Filtros */}
        {vistaActual === 'busqueda' && (
          <div className="space-y-6">
            {/* Panel de filtros */}
            <div className="bg-white p-6 rounded-lg shadow">
              <div className="flex justify-between items-center mb-4">
                <h2 className="text-xl font-semibold">B√∫squeda y Filtros</h2>
                <button
                  onClick={limpiarFiltros}
                  className="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 flex items-center"
                >
                  <X className="w-4 h-4 mr-2" />
                  Limpiar
                </button>
              </div>
              
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {/* B√∫squeda por texto */}
                <div className="md:col-span-2 lg:col-span-3">
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Buscar por nombre o motivo
                  </label>
                  <div className="relative">
                    <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4" />
                    <input
                      type="text"
                      placeholder="Escribe el nombre del empleado o motivo..."
                      value={busqueda.texto}
                      onChange={(e) => setBusqueda({...busqueda, texto: e.target.value})}
                      className="w-full pl-10 pr-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    />
                  </div>
                </div>
                
                {/* Filtro por empleado */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Empleado</label>
                  <select
                    value={busqueda.empleadoId}
                    onChange={(e) => setBusqueda({...busqueda, empleadoId: e.target.value})}
                    className="w-full border rounded-lg px-3 py-2"
                  >
                    <option value="">Todos los empleados</option>
                    {empleados.map(empleado => (
                      <option key={empleado.id} value={empleado.id}>
                        {empleado.nombre}
                      </option>
                    ))}
                  </select>
                </div>
                
                {/* Filtro por tipo */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Tipo</label>
                  <select
                    value={busqueda.tipo}
                    onChange={(e) => setBusqueda({...busqueda, tipo: e.target.value})}
                    className="w-full border rounded-lg px-3 py-2"
                  >
                    <option value="">Todos los tipos</option>
                    <option value="adelanto">Adelanto</option>
                    <option value="prestamo">Pr√©stamo</option>
                    <option value="bono">Bono</option>
                  </select>
                </div>
                
                {/* Rango de fechas */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Fecha desde</label>
                  <input
                    type="date"
                    value={busqueda.fechaInicio}
                    onChange={(e) => setBusqueda({...busqueda, fechaInicio: e.target.value})}
                    className="w-full border rounded-lg px-3 py-2"
                  />
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Fecha hasta</label>
                  <input
                    type="date"
                    value={busqueda.fechaFin}
                    onChange={(e) => setBusqueda({...busqueda, fechaFin: e.target.value})}
                    className="w-full border rounded-lg px-3 py-2"
                  />
                </div>
                
                {/* Rango de montos */}
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Monto m√≠nimo</label>
                  <input
                    type="number"
                    placeholder="0"
                    value={busqueda.montoMin}
                    onChange={(e) => setBusqueda({...busqueda, montoMin: e.target.value})}
                    className="w-full border rounded-lg px-3 py-2"
                  />
                </div>
                
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Monto m√°ximo</label>
                  <input
                    type="number"
                    placeholder="Sin l√≠mite"
                    value={busqueda.montoMax}
                    onChange={(e) => setBusqueda({...busqueda, montoMax: e.target.value})}
                    className="w-full border rounded-lg px-3 py-2"
                  />
                </div>
              </div>
            </div>

            {/* Resultados de b√∫squeda */}
            <div className="bg-white rounded-lg shadow">
              <div className="px-6 py-4 border-b">
                <h3 className="text-lg font-medium">
                  Resultados de b√∫squeda ({adelantosFiltrados.length} encontrados)
                </h3>
                <p className="text-sm text-gray-600 mt-1">
                  Total: ${adelantosFiltrados.reduce((sum, a) => sum + a.monto, 0).toLocaleString()}
                </p>
              </div>
              <div className="overflow-x-auto">
                <table className="min-w-full divide-y divide-gray-200">
                  <thead className="bg-gray-50">
                    <tr>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Empleado</th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Monto</th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Motivo</th>
                    </tr>
                  </thead>
                  <tbody className="bg-white divide-y divide-gray-200">
                    {adelantosFiltrados.length === 0 ? (
                      <tr>
                        <td colSpan="5" className="px-6 py-4 text-center text-gray-500">
                          No se encontraron adelantos que coincidan con los filtros
                        </td>
                      </tr>
                    ) : (
                      adelantosFiltrados.map((adelanto) => (
                        <tr key={adelanto.id} className="hover:bg-gray-50">
                          <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            {obtenerNombreEmpleado(adelanto.empleadoId)}
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {adelanto.fecha}
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-semibold">
                            ${adelanto.monto.toLocaleString()}
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap">
                            <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                              adelanto.tipo === 'adelanto' ? 'bg-blue-100 text-blue-800' :
                              adelanto.tipo === 'prestamo' ? 'bg-red-100 text-red-800' :
                              'bg-green-100 text-green-800'
                            }`}>
                              {adelanto.tipo}
                            </span>
                          </td>
                          <td className="px-6 py-4 text-sm text-gray-500">
                            {adelanto.motivo || 'Sin motivo especificado'}
                          </td>
                        </tr>
                      ))
                    )}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        )}

        {/* Gesti√≥n de Empleados */}
        {vistaActual === 'empleados' && (
          <div className="space-y-6">
            <div className="bg-white p-6 rounded-lg shadow">
              <h2 className="text-xl font-semibold mb-4">Agregar Nuevo Empleado</h2>
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                <input
                  type="text"
                  placeholder="Nombre completo"
                  value={nuevoEmpleado.nombre}
                  onChange={(e) => setNuevoEmpleado({...nuevoEmpleado, nombre: e.target.value})}
                  className="border rounded-lg px-3 py-2"
                />
                <input
                  type="text"
                  placeholder="Cargo"
                  value={nuevoEmpleado.cargo}
                  onChange={(e) => setNuevoEmpleado({...nuevoEmpleado, cargo: e.target.value})}
                  className="border rounded-lg px-3 py-2"
                />
                <input
                  type="number"
                  placeholder="Salario"
                  value={nuevoEmpleado.salario}
                  onChange={(e) => setNuevoEmpleado({...nuevoEmpleado, salario: e.target.value})}
                  className="border rounded-lg px-3 py-2"
                />
              </div>
              <button
                onClick={agregarEmpleado}
                className="mt-4 bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 flex items-center"
              >
                <Plus className="w-4 h-4 mr-2" />
                Agregar Empleado
              </button>
            </div>

            <div className="bg-white rounded-lg shadow">
              <div className="px-6 py-4 border-b">
                <h3 className="text-lg font-medium">Lista de Empleados</h3>
              </div>
              <div className="overflow-x-auto">
                <table className="min-w-full divide-y divide-gray-200">
                  <thead className="bg-gray-50">
                    <tr>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cargo</th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Salario</th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha Ingreso</th>
                      <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Adelantos</th>
                    </tr>
                  </thead>
                  <tbody className="bg-white divide-y divide-gray-200">
                    {empleados.map((empleado) => {
                      const adelantosEmpleado = adelantos.filter(a => a.empleadoId === empleado.id);
                      const totalEmpleado = adelantosEmpleado.reduce((sum, a) => sum + a.monto, 0);
                      
                      return (
                        <tr key={empleado.id}>
                          <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            {empleado.nombre}
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {empleado.cargo}
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            {empleado.salario ? `$${parseFloat(empleado.salario).toLocaleString()}` : 'No especificado'}
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {empleado.fechaIngreso}
                          </td>
                          <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${totalEmpleado.toLocaleString()} ({adelantosEmpleado.length})
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        )}

        {/* Gesti√≥n de Adelantos */}
        {vistaActual === 'adelantos' && (
          <div className="space-y-6">
            <div className="bg-white p-6 rounded-lg shadow">
              <h2 className="text-xl font-semibold mb-4">Registrar Nuevo Adelanto</h2>
              
              {esMesCerrado(mesActual) && (
                <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                  <div className="flex items-center">
                    <Lock className="w-5 h-5 text-red-600" />
                    <div className="ml-3">
                      <h3 className="text-sm font-medium text-red-800">
                        Mes actual cerrado
                      </h3>
                      <p className="text-sm text-red-700 mt-1">
                        No puedes agregar adelantos al mes {mesActual} porque est√° cerrado. Re√°brelo si necesitas hacer modificaciones.
                      </p>
                    </div>
                  </div>
                </div>
              )}

              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <select
                  value={nuevoAdelanto.empleadoId}
                  onChange={(e) => setNuevoAdelanto({...nuevoAdelanto, empleadoId: e.target.value})}
                  className="border rounded-lg px-3 py-2"
                  disabled={esMesCerrado(mesActual)}
                >
                  <option value="">Seleccionar empleado</option>
                  {empleados.map(empleado => (
                    <option key={empleado.id} value={empleado.id}>
                      {empleado.nombre} - {empleado.cargo}
                    </option>
                  ))}
                </select>
                <input
                  type="number"
                  placeholder="Monto"
                  value={nuevoAdelanto.monto}
                  onChange={(e) => setNuevoAdelanto({...nuevoAdelanto, monto: e.target.value})}
                  className="border rounded-lg px-3 py-2"
                  disabled={esMesCerrado(mesActual)}
                />
                <input
                  type="date"
                  value={nuevoAdelanto.fecha}
                  onChange={(e) => setNuevoAdelanto({...nuevoAdelanto, fecha: e.target.value})}
                  className="border rounded-lg px-3 py-2"
                  disabled={esMesCerrado(mesActual)}
                />
                <select
                  value={nuevoAdelanto.tipo}
                  onChange={(e) => setNuevoAdelanto({...nuevoAdelanto, tipo: e.target.value})}
                  className="border rounded-lg px-3 py-2"
                  disabled={esMesCerrado(mesActual)}
                >
                  <option value="adelanto">Adelanto</option>
                  <option value="prestamo">Pr√©stamo</option>
                  <option value="bono">Bono</option>
                </select>
                <input
                  type="text"
                  placeholder="Motivo (opcional)"
                  value={nuevoAdelanto.motivo}
                  onChange={(e) => setNuevoAdelanto({...nuevoAdelanto, motivo: e.target.value})}
                  className="border rounded-lg px-3 py-2 md:col-span-2"
                  disabled={esMesCerrado(mesActual)}
                />
              </div>
              <button
                onClick={agregarAdelanto}
                disabled={esMesCerrado(mesActual)}
                className={`mt-4 px-6 py-2 rounded-lg flex items-center ${
                  esMesCerrado(mesActual) 
                    ? 'bg-gray-400 text-gray-700 cursor-not-allowed' 
                    : 'bg-green-600 text-white hover:bg-green-700'
                }`}
              >
                <Plus className="w-4 h-4 mr-2" />
                Registrar Adelanto
              </button>
            </div>
          </div>
        )}

        {/* Historial de Per√≠odos */}
        {vistaActual === 'historial' && (
          <div className="space-y-6">
            <div className="bg-white p-6 rounded-lg shadow">
              <h2 className="text-xl font-semibold mb-4">Historial de Per√≠odos Mensuales</h2>
              
              <div className="grid gap-4">
                {mesesConDatos.map(mes => {
                  const adelantosMes = adelantos.filter(a => a.fecha.startsWith(mes));
                  const totalMes = adelantosMes.reduce((sum, a) => sum + a.monto, 0);
                  const periodo = periodosMensuales[mes];
                  const cerrado = esMesCerrado(mes);
                  
                  return (
                    <div key={mes} className={`p-4 rounded-lg border-2 ${
                      cerrado ? 'border-orange-200 bg-orange-50' : 'border-green-200 bg-green-50'
                    }`}>
                      <div className="flex justify-between items-center">
                        <div className="flex items-center">
                          {cerrado ? <Lock className="w-5 h-5 text-orange-600 mr-3" /> : <Unlock className="w-5 h-5 text-green-600 mr-3" />}
                          <div>
                            <h3 className="text-lg font-medium text-gray-900">{mes}</h3>
                            <p className="text-sm text-gray-600">
                              {adelantosMes.length} adelantos ‚Ä¢ ${totalMes.toLocaleString()}
                            </p>
                            {periodo && cerrado && (
                              <p className="text-xs text-gray-500">
                                Cerrado: {new Date(periodo.fechaCierre).toLocaleDateString()}
                              </p>
                            )}
                          </div>
                        </div>
                        <div className="flex space-x-2">
                          <button
                            onClick={() => setMesSeleccionado(mes)}
                            className="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 flex items-center"
                          >
                            <Eye className="w-4 h-4 mr-1" />
                            Ver
                          </button>
                          {cerrado && (
                            <button
                              onClick={() => reabrirMes(mes)}
                              className="bg-yellow-600 text-white px-3 py-1 rounded text-sm hover:bg-yellow-700 flex items-center"
                            >
                              <Unlock className="w-4 h-4 mr-1" />
                              Reabrir
                            </button>
                          )}
                        </div>
                      </div>
                    </div>
                  );
                })}
              </div>

              {mesesConDatos.length === 0 && (
                <div className="text-center py-8 text-gray-500">
                  <Calendar className="w-12 h-12 mx-auto mb-4 text-gray-300" />
                  <p>No hay per√≠odos registrados a√∫n</p>
                </div>
              )}
            </div>
          </div>
        )}

        {/* Configuraci√≥n GitHub */}
        {vistaActual === 'config' && (
          <div className="space-y-6">
            <div className="bg-white p-6 rounded-lg shadow">
              <h2 className="text-xl font-semibold mb-4">Configuraci√≥n de GitHub</h2>
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Token de GitHub (Personal Access Token)
                  </label>
                  <input
                    type="password"
                    placeholder="ghp_..."
                    value={configGithub.token}
                    onChange={(e) => setConfigGithub({...configGithub, token: e.target.value})}
                    className="w-full border rounded-lg px-3 py-2"
                  />
                  <p className="text-xs text-gray-500 mt-1">
                    Crear en: GitHub ‚Üí Settings ‚Üí Developer settings ‚Üí Personal access tokens
                  </p>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Propietario del repositorio
                    </label>
                    <input
                      type="text"
                      placeholder="tu-usuario"
                      value={configGithub.owner}
                      onChange={(e) => setConfigGithub({...configGithub, owner: e.target.value})}
                      className="w-full border rounded-lg px-3 py-2"
                    />
                  </div>
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Nombre del repositorio
                    </label>
                    <input
                      type="text"
                      placeholder="adelantos-empresa"
                      value={configGithub.repo}
                      onChange={(e) => setConfigGithub({...configGithub, repo: e.target.value})}
                      className="w-full border rounded-lg px-3 py-2"
                    />
                  </div>
                </div>
                <button
                  onClick={configurarGithub}
                  className="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 flex items-center"
                >
                  <Save className="w-4 h-4 mr-2" />
                  Guardar Configuraci√≥n
                </button>
                {configGithub.configurado && (
                  <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                    <div className="flex">
                      <Github className="w-5 h-5 text-green-600" />
                      <div className="ml-3">
                        <h3 className="text-sm font-medium text-green-800">
                          GitHub configurado correctamente
                        </h3>
                        <p className="text-sm text-green-700 mt-1">
                          Repositorio: {configGithub.owner}/{configGithub.repo}
                        </p>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>

            <div className="bg-white p-6 rounded-lg shadow">
              <h3 className="text-lg font-semibold mb-4">Nuevas Funcionalidades</h3>
              <div className="space-y-3 text-sm text-gray-600">
                <div className="flex items-start">
                  <div className="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium mr-3 mt-0.5">üîç</div>
                  <p><strong>B√∫squeda avanzada:</strong> Filtra por nombre, fecha, monto o tipo</p>
                </div>
                <div className="flex items-start">
                  <div className="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium mr-3 mt-0.5">üìÖ</div>
                  <p><strong>Vista de calendario:</strong> Visualiza adelantos por fecha</p>
                </div>
                <div className="flex items-start">
                  <div className="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium mr-3 mt-0.5">üîí</div>
                  <p><strong>Control mensual:</strong> Cierra meses para proteger datos</p>
                </div>
                <div className="flex items-start">
                  <div className="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium mr-3 mt-0.5">üìä</div>
                  <p><strong>Estad√≠sticas:</strong> Totales separados por mes autom√°ticamente</p>
                </div>
              </div>
            </div>
          </div>
        )}

        {/* Modal para adelantos seleccionados en calendario */}
        {adelantoSeleccionado && (
          <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div className="bg-white rounded-lg p-6 max-w-md w-full">
              <div className="flex justify-between items-center mb-4">
                <h3 className="text-lg font-semibold">
                  Adelantos del d√≠a
                </h3>
                <button
                  onClick={() => setAdelantoSeleccionado(null)}
                  className="text-gray-400 hover:text-gray-600"
                >
                  <X className="w-5 h-5" />
                </button>
              </div>
              <div className="space-y-3">
                {adelantoSeleccionado.map(adelanto => (
                  <div key={adelanto.id} className="border rounded-lg p-3">
                    <div className="flex justify-between items-start">
                      <div>
                        <p className="font-medium">{obtenerNombreEmpleado(adelanto.empleadoId)}</p>
                        <p className="text-sm text-gray-600">{adelanto.motivo || 'Sin motivo'}</p>
                      </div>
                      <div className="text-right">
                        <p className="font-semibold">${adelanto.monto.toLocaleString()}</p>
                        <span className={`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                          adelanto.tipo === 'adelanto' ? 'bg-blue-100 text-blue-800' :
                          adelanto.tipo === 'prestamo' ? 'bg-red-100 text-red-800' :
                          'bg-green-100 text-green-800'
                        }`}>
                          {adelanto.tipo}
                        </span>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
              <div className="mt-4 pt-3 border-t">
                <p className="text-sm font-medium text-gray-900">
                  Total del d√≠a: ${adelantoSeleccionado.reduce((sum, a) => sum + a.monto, 0).toLocaleString()}
                </p>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

export default SistemaAdelantos;
